<!--
Copyright 2017 Next Century Corporation

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>search-fields-dialog</title>
  <script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../bower_components/web-component-tester/browser.js"></script>
  <link rel="import" href="../search-fields-dialog.html">
</head>

<body>
  <test-fixture id="search-fields-dialog-fixture">
    <template>
      <search-fields-dialog></search-fields-dialog>
    </template>
  </test-fixture>

  <script>
    /* globals suite, setup, flush, test, fixture, assert */
    suite('search-fields-dialog tests', function() {
      var element;

      var cityConfig = {
        icon: 'city-icon',
        key: 'city',
        styleClass: 'city-style',
        title: 'City',
        enableNetworkExpansion: true,
        activateNetworkExpansion: true
      };
      var countryConfig = {
        icon: 'country-icon',
        key: 'country',
        styleClass: 'country-style',
        title: 'Country',
        enableNetworkExpansion: true,
        activateNetworkExpansion: true
      };
      var dateStartConfig = {
        icon: 'date-start-icon',
        key: 'dateStart',
        styleClass: 'date-start-style',
        title: 'From'
      };
      var dateEndConfig = {
        icon: 'date-end-icon',
        key: 'dateEnd',
        styleClass: 'date-end-style',
        title: 'To'
      };
      var descriptionConfig = {
        icon: 'description-icon',
        key: 'description',
        styleClass: 'description-style',
        title: 'Description'
      };
      var emailConfig = {
        icon: 'email-icon',
        key: 'email',
        styleClass: 'email-style',
        title: 'Email Address',
        enableNetworkExpansion: true
      };
      var imageConfig = {
        icon: 'image-icon',
        key: 'image',
        styleClass: 'image-style',
        title: 'Image'
      };
      var phoneConfig = {
        icon: 'phone-icon',
        key: 'phone',
        styleClass: 'phone-style',
        title: 'Telephone Number',
        enableNetworkExpansion: true
      };
      var titleConfig = {
        icon: 'title-icon',
        key: 'title',
        styleClass: 'title-style',
        title: 'Title'
      };
      var urlConfig = {
        icon: 'url-icon',
        key: 'url',
        styleClass: 'url-style',
        title: 'URL'
      };
      var websiteConfig = {
        icon: 'website-icon',
        key: 'website',
        styleClass: 'website-style',
        title: 'Website'
      };

      setup(function(done) {
        element = fixture('search-fields-dialog-fixture');
        element.dateConfig = {
          dateStart: 'postingDate',
          dateEnd: 'postingDate'
        };
        element.networkExpansionParameters = {
          city: false
        };
        element.processRequest = true;
        element.searchFieldsConfig = [{
          type: 'date',
          name: 'Dates',
          data: [dateStartConfig, dateEndConfig]
        }, {
          name: 'Identifiers',
          data: [phoneConfig, emailConfig]
        }, {
          name: 'Locations',
          data: [cityConfig, countryConfig]
        }, {
          name: 'Ads',
          data: [websiteConfig, titleConfig, descriptionConfig, urlConfig]
        }, {
          type: 'image',
          name: 'Images',
          data: [imageConfig]
        }];
        element.searchParameters = {
          city: {},
          country: {},
          description: {},
          email: {},
          image: {},
          phone: {},
          postingDate: {},
          title: {},
          url: {},
          website: {}
        };
        flush(done);
      });

      test('properties are set as expected', function() {
        assert.equal(element.dataProperty, 'data');
        assert.equal(element.dataIconProperty, 'icon');
        assert.equal(element.dataKeyProperty, 'key');
        assert.equal(element.dataStyleClassProperty, 'styleClass');
        assert.equal(element.dataTitleProperty, 'title');
        assert.equal(element.imageUploadUrl, '/uploadImage');
        assert.equal(element.imageUrlPrefix, '');
        assert.equal(element.imageUrlSuffix, '');
        assert.equal(element.largeImageStyleClass, '');
        assert.equal(element.nameProperty, 'name');
        assert.equal(element.smallImageStyleClass, '');
        assert.equal(element.typeProperty, 'type');

        assert.isTrue(element.processRequest);
        assert.isFalse(element.hideImages);
        assert.isFalse(element.opened);

        assert.deepEqual(element.dateConfig, {
          dateStart: 'postingDate',
          dateEnd: 'postingDate'
        });
        assert.deepEqual(element.images, []);
        assert.deepEqual(element.imagesProcessing, []);
        assert.deepEqual(element.networkExpansionParameters, {
          city: false
        });
        assert.deepEqual(element.searchParameters, {
          city: {},
          country: {},
          description: {},
          email: {},
          image: {},
          phone: {},
          postingDate: {},
          title: {},
          url: {},
          website: {}
        });

        assert.equal(element._linksInput, '');

        assert.isFalse(element._openedDialogHelp);
        assert.isFalse(element._openedDialogImages);
        assert.isFalse(element._showAdvanced);

        assert.deepEqual(element._imageResults, {
          images: [],
          selected: []
        });
        assert.deepEqual(element._imagesSelected, []);
        assert.deepEqual(element._uploadedFiles, []);
      });

      test('does have the button to open the search dialog', function() {
        assert.isNotNull(element.$$('paper-button.open-dialog-button'));
        assert.isFalse(element.$$('paper-button.open-dialog-button').active);
        assert.isNotNull(element.$$('paper-button.open-dialog-button iron-icon[icon="fa:search"]'));
        assert.isNotNull(element.$$('paper-button.open-dialog-button div'));
      });

      test('does have the search dialog', function() {
        assert.isNotNull(element.$$('.search-dialog'));
        assert.isTrue(element.$$('.search-dialog').fill);
        assert.isTrue(element.$$('.search-dialog').modal);
        assert.isFalse(element.$$('.search-dialog').opened);
        assert.isFalse(element.$$('.search-dialog').classList.contains('backdrop'));
      });

      test('does have the help dialog', function() {
        assert.isNotNull(element.$$('.help-dialog'));
        assert.isFalse(element.$$('.help-dialog').fill);
        assert.isFalse(element.$$('.help-dialog').modal);
        assert.isFalse(element.$$('.help-dialog').opened);
      });

      test('does have the images dialog and elements', function() {
        assert.isNotNull(element.$$('.images-dialog'));
        assert.isTrue(element.$$('.images-dialog').fill);
        assert.isFalse(element.$$('.images-dialog').modal);
        assert.isFalse(element.$$('.images-dialog').opened);
      });

      test('images dialog does have an image gallery', function() {
        var inputGallery = Polymer.dom(element.root).querySelectorAll('.images-dialog image-gallery');
        assert.equal(inputGallery.length, 1);

        assert.equal(inputGallery[0].imageNameProperty, 'id');
        assert.isTrue(inputGallery[0].classList.contains('input-gallery'));
        assert.isTrue(inputGallery[0].showDelete);
        assert.isTrue(inputGallery[0].showLabels);
        assert.isTrue(inputGallery[0].showSelect);
        assert.deepEqual(inputGallery[0].images, []);
        assert.deepEqual(inputGallery[0].processing, []);
        assert.deepEqual(inputGallery[0].selected, []);
      });

      test('images dialog does have two image galleries if _imageResults.id is defined', function(done) {
        element.set('_imageResults.id', 'id1');

        flush(function() {
          var inputGallery = Polymer.dom(element.root).querySelectorAll('.images-dialog image-gallery');
          assert.equal(inputGallery.length, 1);

          assert.equal(inputGallery[0].imageNameProperty, 'id');
          assert.isTrue(inputGallery[0].classList.contains('input-gallery'));
          assert.isTrue(inputGallery[0].showDelete);
          assert.isTrue(inputGallery[0].showLabels);
          assert.isTrue(inputGallery[0].showSelect);
          assert.deepEqual(inputGallery[0].images, []);
          assert.deepEqual(inputGallery[0].processing, []);
          assert.deepEqual(inputGallery[0].selected, []);

          var resultsGallery = Polymer.dom(element.root).querySelectorAll('.images-dialog auto-paginated-image-gallery');
          assert.equal(resultsGallery.length, 1);

          assert.isTrue(resultsGallery[0].classList.contains('results-gallery'));
          assert.isTrue(resultsGallery[0].newTab);
          assert.isTrue(resultsGallery[0].showLabels);
          assert.isTrue(resultsGallery[0].showSelect);
          assert.isTrue(resultsGallery[0].showSelectPreceding);
          assert.deepEqual(resultsGallery[0].images, []);
          assert.deepEqual(resultsGallery[0].selected, []);

          done();
        });
      });

      test('image galleries do have expected images', function(done) {
        element.images = [{
          hits: [],
          id: 'image1',
          source: 'source1'
        }, {
          hits: [],
          id: 'image2',
          source: 'source2'
        }];
        element.imagesProcessing = ['image1'];
        element._imagesSelected = ['image2'];
        element._imageResults = {
          id: 'id1',
          images: [{
            id: 'image3',
            source: 'source3'
          }, {
            id: 'image4',
            source: 'source4'
          }],
          selected: ['image3']
        };

        flush(function() {
          var inputGallery = Polymer.dom(element.root).querySelectorAll('.images-dialog image-gallery');
          assert.equal(inputGallery.length, 1);

          assert.equal(inputGallery[0].imageNameProperty, 'id');
          assert.isTrue(inputGallery[0].classList.contains('input-gallery'));
          assert.isTrue(inputGallery[0].showDelete);
          assert.isTrue(inputGallery[0].showLabels);
          assert.isTrue(inputGallery[0].showSelect);
          assert.deepEqual(inputGallery[0].images, [{
            hits: [],
            id: 'image1',
            source: 'source1'
          }, {
            hits: [],
            id: 'image2',
            source: 'source2'
          }]);
          assert.deepEqual(inputGallery[0].processing, ['image1']);
          assert.deepEqual(inputGallery[0].selected, ['image2']);

          var resultsGallery = Polymer.dom(element.root).querySelectorAll('.images-dialog auto-paginated-image-gallery');
          assert.equal(resultsGallery.length, 1);

          assert.isTrue(resultsGallery[0].classList.contains('results-gallery'));
          assert.isTrue(resultsGallery[0].newTab);
          assert.isTrue(resultsGallery[0].showLabels);
          assert.isTrue(resultsGallery[0].showSelect);
          assert.isTrue(resultsGallery[0].showSelectPreceding);
          assert.deepEqual(resultsGallery[0].images, [{
            id: 'image3',
            source: 'source3'
          }, {
            id: 'image4',
            source: 'source4'
          }]);
          assert.deepEqual(resultsGallery[0].selected, ['image3']);

          done();
        });
      });

      test('images dialog does have image input elements', function() {
        assert.isNotNull(element.$$('.images-dialog div[slot="bottom"] .link-data paper-input'));
        assert.isNotNull(element.$$('.images-dialog div[slot="bottom"] .link-data paper-icon-button'));
        assert.isNotNull(element.$$('.images-dialog div[slot="bottom"] vaadin-upload'));
      });

      test('search dialog does have date pickers', function() {
        var datePickers = Polymer.dom(element.root).querySelectorAll('.search-dialog vaadin-date-picker-display');
        assert.equal(datePickers.length, 2);
        assert.deepEqual(datePickers[0].facetKey, 'value');
        assert.equal(datePickers[0].facets, element._searchFields[0].data[0]);
        assert.deepEqual(datePickers[0].facets, {
          icon: 'date-start-icon',
          key: 'dateStart',
          styleClass: 'date-start-style',
          title: 'From',
          value: {}
        });
        assert.deepEqual(datePickers[0].key, 'dateStart');
        assert.deepEqual(datePickers[0].category, 'From');
        assert.deepEqual(datePickers[1].facetKey, 'value');
        assert.equal(datePickers[1].facets, element._searchFields[0].data[1]);
        assert.deepEqual(datePickers[1].facets, {
          icon: 'date-end-icon',
          key: 'dateEnd',
          styleClass: 'date-end-style',
          title: 'To',
          value: {}
        });
        assert.deepEqual(datePickers[1].key, 'dateEnd');
        assert.deepEqual(datePickers[1].category, 'To');
      });

      test('search dialog does have paper inputs for the search fields', function() {
        var paperInputs = Polymer.dom(element.root).querySelectorAll('.search-dialog .search-data paper-input');
        assert.equal(paperInputs.length, 8);
        assert.equal(paperInputs[0].id, 'input_phone');
        assert.equal(paperInputs[0].label, 'Telephone Number');
        assert.equal(paperInputs[0].value, '');
        assert.equal(paperInputs[1].id, 'input_email');
        assert.equal(paperInputs[1].label, 'Email Address');
        assert.equal(paperInputs[1].value, '');
        assert.equal(paperInputs[2].id, 'input_city');
        assert.equal(paperInputs[2].label, 'City');
        assert.equal(paperInputs[2].value, '');
        assert.equal(paperInputs[3].id, 'input_country');
        assert.equal(paperInputs[3].label, 'Country');
        assert.equal(paperInputs[3].value, '');
        assert.equal(paperInputs[4].id, 'input_website');
        assert.equal(paperInputs[4].label, 'Website');
        assert.equal(paperInputs[4].value, '');
        assert.equal(paperInputs[5].id, 'input_title');
        assert.equal(paperInputs[5].label, 'Title');
        assert.equal(paperInputs[5].value, '');
        assert.equal(paperInputs[6].id, 'input_description');
        assert.equal(paperInputs[6].label, 'Description');
        assert.equal(paperInputs[6].value, '');
        assert.equal(paperInputs[7].id, 'input_url');
        assert.equal(paperInputs[7].label, 'URL');
        assert.equal(paperInputs[7].value, '');
      });

      test('paper inputs for the search fields do have expected values', function() {
        element.set(['_searchFields', 1, 'data', 0, 'value'], 'testPhone');
        element.set(['_searchFields', 1, 'data', 1, 'value'], 'testEmail');
        element.set(['_searchFields', 2, 'data', 0, 'value'], 'testCity');
        element.set(['_searchFields', 2, 'data', 1, 'value'], 'testCountry');
        element.set(['_searchFields', 3, 'data', 0, 'value'], 'testWebsite');
        element.set(['_searchFields', 3, 'data', 1, 'value'], 'testTitle');
        element.set(['_searchFields', 3, 'data', 2, 'value'], 'testDescription');
        element.set(['_searchFields', 3, 'data', 3, 'value'], 'testURL');

        var paperInputs = Polymer.dom(element.root).querySelectorAll('.search-dialog .search-data paper-input');
        assert.equal(paperInputs.length, 8);
        assert.equal(paperInputs[0].value, 'testPhone');
        assert.equal(paperInputs[1].value, 'testEmail');
        assert.equal(paperInputs[2].value, 'testCity');
        assert.equal(paperInputs[3].value, 'testCountry');
        assert.equal(paperInputs[4].value, 'testWebsite');
        assert.equal(paperInputs[5].value, 'testTitle');
        assert.equal(paperInputs[6].value, 'testDescription');
        assert.equal(paperInputs[7].value, 'testURL');
      });

      test('search dialog does not have paper icon buttons for the search fields if _showAdvanced is false', function() {
        var buttons = Polymer.dom(element.root).querySelectorAll('.search-dialog .search-data paper-icon-button');
        assert.equal(buttons.length, 0);
      });

      test('search dialog does have paper icon buttons for the search fields if _showAdvanced is true', function(done) {
        element._showAdvanced = true;
        flush(function() {
          var buttons = Polymer.dom(element.root).querySelectorAll('.search-dialog .search-data paper-icon-button');
          assert.equal(buttons.length, 12);
          done();
        });
      });

      test('search dialog does have image gallery for the image field', function() {
        var gallery = Polymer.dom(element.root).querySelectorAll('.search-dialog search-image-gallery');
        assert.equal(gallery.length, 1);
        assert.deepEqual(gallery[0].excluded, []);
        assert.deepEqual(gallery[0].images, []);
        assert.deepEqual(gallery[0].required, []);
        assert.deepEqual(gallery[0].selected, []);
        assert.deepEqual(gallery[0].union, []);
      });

      test('search image gallery does have expected images', function() {
        element.set(['_searchFields', 4, 'data', 0, 'images'], [{
          hits: [],
          id: 'image1',
          source: 'source1'
        }, {
          hits: [],
          id: 'image2',
          source: 'source2'
        }, {
          hits: [],
          id: 'image3',
          source: 'source3'
        }, {
          hits: [],
          id: 'image4',
          source: 'source4'
        }, {
          hits: [],
          id: 'image5',
          source: 'source5'
        }]);
        element.set(['_searchFields', 4, 'data', 0, 'selected'], ['image2', 'image3', 'image4', 'image5']);
        element.set(['_searchFields', 4, 'data', 0, 'required'], ['image3']);
        element.set(['_searchFields', 4, 'data', 0, 'excluded'], ['image4']);
        element.set(['_searchFields', 4, 'data', 0, 'union'], ['image5']);

        var gallery = Polymer.dom(element.root).querySelectorAll('.search-dialog search-image-gallery');
        assert.equal(gallery.length, 1);
        assert.deepEqual(gallery[0].excluded, ['image4']);
        assert.deepEqual(gallery[0].images, [{
          hits: [],
          id: 'image1',
          source: 'source1'
        }, {
          hits: [],
          id: 'image2',
          source: 'source2'
        }, {
          hits: [],
          id: 'image3',
          source: 'source3'
        }, {
          hits: [],
          id: 'image4',
          source: 'source4'
        }, {
          hits: [],
          id: 'image5',
          source: 'source5'
        }]);
        assert.deepEqual(gallery[0].required, ['image3']);
        assert.deepEqual(gallery[0].selected, ['image2', 'image3', 'image4', 'image5']);
        assert.deepEqual(gallery[0].union, ['image5']);
      });

      test('search dialog does have expected header buttons', function() {
        var buttons = Polymer.dom(element.root).querySelectorAll('.search-dialog div[slot="top"].header button-action');
        assert.isNotNull(buttons);
        assert.equal(buttons.length, 6);
        assert.equal(buttons[0].text, 'Search');
        assert.equal(buttons[1].text, 'Help');
        assert.equal(buttons[2].text, 'Images');
        assert.equal(buttons[3].text, 'Advanced');
        assert.equal(buttons[4].text, 'Clear');
        assert.equal(buttons[5].text, 'Cancel');
      });

      test('search dialog does have image input elements', function() {
        assert.isNotNull(element.$$('.search-dialog div[slot="bottom"] .link-data paper-input'));
        assert.isNotNull(element.$$('.search-dialog div[slot="bottom"] .link-data paper-icon-button'));
        assert.isNotNull(element.$$('.search-dialog div[slot="bottom"] vaadin-upload'));
      });

      test('_searchFields is as expected', function() {
        assert.deepEqual(element._searchFields, [{
          name: 'Dates',
          isImage: false,
          isDate: true,
          data: [{
            icon: 'date-start-icon',
            key: 'dateStart',
            styleClass: 'date-start-style',
            title: 'From',
            value: {}
          }, {
            icon: 'date-end-icon',
            key: 'dateEnd',
            styleClass: 'date-end-style',
            title: 'To',
            value: {}
          }]
        }, {
          name: 'Identifiers',
          isImage: false,
          isDate: false,
          data: [{
            icon: 'phone-icon',
            key: 'phone',
            styleClass: 'phone-style',
            title: 'Telephone Number',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: true,
            requireOnePrevious: true
          }, {
            icon: 'email-icon',
            key: 'email',
            styleClass: 'email-style',
            title: 'Email Address',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: true,
            requireOnePrevious: true
          }]
        }, {
          name: 'Locations',
          isImage: false,
          isDate: false,
          data: [{
            icon: 'city-icon',
            key: 'city',
            styleClass: 'city-style',
            title: 'City',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: true,
            requireOnePrevious: true
          }, {
            icon: 'country-icon',
            key: 'country',
            styleClass: 'country-style',
            title: 'Country',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: true,
            requireOnePrevious: true
          }]
        }, {
          name: 'Ads',
          isImage: false,
          isDate: false,
          data: [{
            icon: 'website-icon',
            key: 'website',
            styleClass: 'website-style',
            title: 'Website',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: true,
            requireOnePrevious: true
          }, {
            icon: 'title-icon',
            key: 'title',
            styleClass: 'title-style',
            title: 'Title',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: true,
            requireOnePrevious: true
          }, {
            icon: 'description-icon',
            key: 'description',
            styleClass: 'description-style',
            title: 'Description',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: true,
            requireOnePrevious: true
          }, {
            icon: 'url-icon',
            key: 'url',
            styleClass: 'url-style',
            title: 'URL',
            value: '',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: true,
            requireOnePrevious: true
          }]
        }, {
          name: 'Images',
          isImage: true,
          isDate: false,
          data: [{
            icon: 'image-icon',
            key: 'image',
            styleClass: 'image-style',
            title: 'Image',
            images: [],
            excluded: [],
            required: [],
            selected: [],
            union: []
          }]
        }]);
      });

      test('default buildSearchParameter is as expected', function() {
        assert.isFunction(element.buildSearchParameter);
        assert.deepEqual(element.buildSearchParameter('category', 'enabled', 'key', 'text', 'search'), {
          category: 'category',
          date: undefined,
          enabled: 'enabled',
          key: 'key',
          search: 'search',
          text: 'text'
        });
        assert.deepEqual(element.buildSearchParameter('category', 'enabled', 'key', 'text', 'search', 'date'), {
          category: 'category',
          date: 'date',
          enabled: 'enabled',
          key: 'key',
          search: 'search',
          text: 'text'
        });
      });

      test('default getSearchParameterData is as expected', function() {
        assert.isFunction(element.getSearchParameterData);
        assert.deepEqual(element.getSearchParameterData({
          category: 'category',
          date: undefined,
          enabled: 'enabled',
          key: 'key',
          search: 'search',
          text: 'text'
        }), {
          enabled: 'enabled',
          search: 'search',
          text: 'text'
        });
      });

      test('_didUserHitEnterKey does not call handleSearch if search parameters are undefined', function() {
        element.opened = true;
        element._didUserHitEnterKey({keyCode: 13});

        assert.isTrue(element.opened);
      });

      test('_didUserHitEnterKey does call handleSearch if search parameters are enabled and enter key is used', function() {
        element.opened = true;
        element._searchFields[2].data[0].value = 'nyc';
        element._didUserHitEnterKey({keyCode: 13});

        assert.isFalse(element.opened);
      });

      test('_didUserHitEnterKey does not call handleSearch if something besides the enter key is clicked', function() {
        element.opened = true;
        element._didUserHitEnterKey({keyCode: 10});

        assert.isTrue(element.opened);
      });

      test('_didUserHitEnterKeyOnLinksInput does update images', function() {
        element._linksInput = 'testLink';
        element._didUserHitEnterKeyOnLinksInput({
          keyCode: 13
        });

        assert.deepEqual(element.images, [{
          id: 'testLink',
          source: 'testLink',
          type: 'LINK'
        }]);
        assert.isTrue(element._openedDialogImages);
        assert.equal(element._linksInput, '');
      });

      test('_didUserHitEnterKeyOnLinksInput does not update images if keyCode is not ENTER (13)', function() {
        element._linksInput = 'testLink';
        element._didUserHitEnterKeyOnLinksInput({
          keyCode: 1
        });

        assert.deepEqual(element.images, []);
        assert.isFalse(element._openedDialogImages);
        assert.equal(element._linksInput, 'testLink');
      });

      test('_didUserHitEnterKeyOnLinksInput does not update images if _linksInput is empty', function() {
        element._didUserHitEnterKeyOnLinksInput({
          keyCode: 13
        });

        assert.deepEqual(element.images, []);
        assert.isFalse(element._openedDialogImages);
      });

      test('_getButtonStyleClass does return as expected', function() {
        assert.equal(element._getButtonStyleClass(true), 'on');
        assert.equal(element._getButtonStyleClass(false), 'off');
      });

      test('_getButtonText does return as expected', function() {
        assert.equal(element._getButtonText(true), 'On');
        assert.equal(element._getButtonText(false), 'Off');
      });

      test('_getInputWidthStyleClass does return as expected', function() {
        assert.equal(element._getInputWidthStyleClass(false, false), '');
        assert.equal(element._getInputWidthStyleClass(true, false), '');
        assert.equal(element._getInputWidthStyleClass(false, true), 'one-icon');
        assert.equal(element._getInputWidthStyleClass(true, true), 'two-icon');
      });

      test('_getNetworkExpansionStyleClass does return as expected', function() {
        assert.equal(element._getNetworkExpansionStyleClass(false, false), 'off inactive');
        assert.equal(element._getNetworkExpansionStyleClass(false, true), 'off');
        assert.equal(element._getNetworkExpansionStyleClass(true, false), 'on inactive');
        assert.equal(element._getNetworkExpansionStyleClass(true, true), 'on');
      });

      test('_handleImageFileUploadSuccess does not update images or _openedDialogImages if mimeType is not image', function() {
        element._handleImageFileUploadSuccess({
          detail: {
            file: {
              name: 'testName'
            },
            xhr: {
              response: '{"base64": "testData", "mimeType": "notimage"}'
            }
          }
        });

        assert.deepEqual(element.images, []);
        assert.isFalse(element._openedDialogImages);
      });

      test('_handleImageFileUploadSuccess does update images and _openedDialogImages', function() {
        element._handleImageFileUploadSuccess({
          detail: {
            file: {
              name: 'testName'
            },
            xhr: {
              response: '{"base64": "testData", "mimeType": "image"}'
            }
          }
        });

        assert.deepEqual(element.images, [{
          id: 'testName',
          source: 'data:image;base64,testData',
          type: 'DATA'
        }]);
        assert.isTrue(element._openedDialogImages);
      });

      test('_handleImageFileUploadSuccess does keep existing images', function() {
        element.images = [{
          id: 'existingId',
          source: 'existingSource'
        }];

        element._handleImageFileUploadSuccess({
          detail: {
            file: {
              name: 'testName'
            },
            xhr: {
              response: '{"base64": "testData", "mimeType": "image"}'
            }
          }
        });

        assert.deepEqual(element.images, [{
          id: 'existingId',
          source: 'existingSource'
        }, {
          id: 'testName',
          source: 'data:image;base64,testData',
          type: 'DATA'
        }]);
        assert.isTrue(element._openedDialogImages);
      });

      test('_handleImagesSelected does update _imageResults', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }];

        element._handleImagesSelected(['image1']);

        assert.deepEqual(element._imageResults, {
          id: 'image1',
          images: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }],
          selected: []
        });
      });

      test('_handleImagesSelected does update _imageResults if given no selected images', function() {
        element._imageResults = {
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }],
          selected: []
        };

        element._handleImagesSelected([]);

        assert.deepEqual(element._imageResults, {
          images: [],
          selected: []
        });
      });

      test('_handleImagesSelected does update _imagesSelected and _imageResults if given multiple selected images', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }, {
          id: 'image2',
          hits: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }]
        }];

        element._handleImagesSelected(['image1', 'image2']);

        assert.deepEqual(element._imagesSelected, ['image2']);
        assert.deepEqual(element._imageResults, {
          id: 'image2',
          images: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }],
          selected: []
        });
      });

      test('_handleImageResultsModified does update _imageResults', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }];

        element._handleImageResultsModified('image1', [{
          id: 'hit2',
          source: 'source2'
        }]);

        assert.deepEqual(element.images, [{
          id: 'image1',
          hits: [{
            id: 'hit2',
            source: 'source2'
          }]
        }]);
      });

      test('_handleImageResultsSelected does update images, selected, and union properties in _searchFields', function() {
        element._searchFields[4].data[0] = {
          key: 'image',
          images: [],
          selected: [],
          union: []
        };

        element._imageResults.images = [{
          id: 'image1',
          source: 'source1'
        }];

        element._handleImageResultsSelected(['image1']);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }],
          selected: ['image1'],
          union: ['image1']
        });
      });

      test('_handleImageResultsSelected does work with multiple selected images', function() {
        element._searchFields[4].data[0] = {
          key: 'image',
          images: [],
          selected: [],
          union: []
        };

        element._imageResults.images = [{
          id: 'image1',
          source: 'source1'
        }, {
          id: 'image2',
          source: 'source2'
        }];

        element._handleImageResultsSelected(['image1', 'image2']);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }, {
            id: 'image2',
            source: 'source2'
          }],
          selected: ['image1', 'image2'],
          union: ['image1', 'image2']
        });
      });

      test('_handleImageResultsSelected does work with existing images', function() {
        element._searchFields[4].data[0] = {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }, {
            id: 'image2',
            source: 'source2'
          }],
          selected: [],
          union: []
        };

        element._imageResults.images = [{
          id: 'image2',
          source: 'source2'
        }, {
          id: 'image3',
          source: 'source3'
        }, {
          id: 'image4',
          source: 'source4'
        }];

        element._handleImageResultsSelected(['image2', 'image3']);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }, {
            id: 'image2',
            source: 'source2'
          }, {
            id: 'image3',
            source: 'source3'
          }],
          selected: ['image2', 'image3'],
          union: ['image2', 'image3']
        });
      });

      test('_handleImageResultsSelected does work with existing selected images', function() {
        element._searchFields[4].data[0] = {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }, {
            id: 'image2',
            source: 'source2'
          }, {
            id: 'image3',
            source: 'source3'
          }, {
            id: 'image4',
            source: 'source4'
          }],
          selected: ['image2', 'image3'],
          union: ['image2', 'image3']
        };

        element._imageResults.images = [{
          id: 'image3',
          source: 'source3'
        }, {
          id: 'image4',
          source: 'source4'
        }, {
          id: 'image5',
          source: 'source5'
        }, {
          id: 'image6',
          source: 'source6'
        }];

        element._handleImageResultsSelected(['image3', 'image4', 'image5']);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }, {
            id: 'image2',
            source: 'source2'
          }, {
            id: 'image3',
            source: 'source3'
          }, {
            id: 'image4',
            source: 'source4'
          }, {
            id: 'image5',
            source: 'source5'
          }],
          selected: ['image2', 'image3', 'image4', 'image5'],
          union: ['image2', 'image3', 'image4', 'image5']
        });
      });

      test('_handleLinksInput does not update images or _openedDialogImages if _linksInput is empty', function() {
        element._handleLinksInput();

        assert.deepEqual(element.images, []);
        assert.isFalse(element._openedDialogImages);
      });

      test('_handleLinksInput does update images, _linksInput, and _openedDialogImages', function() {
        element._linksInput = ' testLink1 testLink2\ttestLink3\ntestLink4\n\n';
        element._handleLinksInput();

        assert.deepEqual(element.images, [{
          id: 'testLink1',
          source: 'testLink1',
          type: 'LINK'
        }, {
          id: 'testLink2',
          source: 'testLink2',
          type: 'LINK'
        }, {
          id: 'testLink3',
          source: 'testLink3',
          type: 'LINK'
        }, {
          id: 'testLink4',
          source: 'testLink4',
          type: 'LINK'
        }]);
        assert.isTrue(element._openedDialogImages);
        assert.equal(element._linksInput, '');
      });

      test('_handleLinksInput does keep existing images', function() {
        element.images = [{
          id: 'existingId',
          source: 'existingSource'
        }];
        element._linksInput = 'testLink';
        element._handleLinksInput();

        assert.deepEqual(element.images, [{
          id: 'existingId',
          source: 'existingSource'
        }, {
          id: 'testLink',
          source: 'testLink',
          type: 'LINK'
        }]);
        assert.isTrue(element._openedDialogImages);
        assert.equal(element._linksInput, '');
      });

      test('_isBackdrop does return as expected', function() {
        assert.equal(element._isBackdrop(false, false), '');
        assert.equal(element._isBackdrop(false, true), 'backdrop');
        assert.equal(element._isBackdrop(true, true), 'backdrop');
        assert.equal(element._isBackdrop(true, true), 'backdrop');
      });

      test('_updateDateFieldFromParameter does update _searchFields as expcted', function() {
        element.searchParameters.postingDate = {
          dateStart: {
            category: 'From',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateStart',
            search: 'required',
            text: '03/01/2017'
          }
        };

        element._updateDateFieldFromParameter(element._searchFields[0].data[0], ['_searchFields', 0, 'data', 0]);

        assert.deepEqual(element._searchFields[0].data[0].value, {
          dateStart: {
            category: 'From',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateStart',
            search: 'required',
            text: '03/01/2017'
          }
        });
      });

      test('_updateDateParameterAndNotify does update searchParameters and notify listeners', function(done) {
        element.onSearchParametersChange = function() {
          assert.deepEqual(element.searchParameters.postingDate, {
            dateStart: {
              category: 'From',
              date: '2017-03-01T00:00:00',
              enabled: true,
              key: 'dateStart',
              search: 'required',
              text: '03/01/2017'
            }
          });
          done();
        };

        element.listen(element, 'search-parameters-changed', 'onSearchParametersChange');

        assert.deepEqual(element.searchParameters.postingDate, {});

        element._updateDateParameterAndNotify('dateStart', '2017-03-01T00:00:00', '03/01/2017', 'From', true);
      });

      test('_updateDateParameterFromField does update date parameter', function() {
        element._searchFields[0].data[1].value = {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateEnd',
            text: '03/01/2017'
          }
        };

        element._updateDateParameterFromField(element._searchFields[0].data[1]);

        assert.deepEqual(element.searchParameters.postingDate, {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateEnd',
            search: 'required',
            text: '03/01/2017'
          }
        });
      });

      test('_updateDateParameterFromField does clear date parameter', function() {
        element.searchParameters.postingDate = {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: true,
            key: 'dateEnd',
            text: '03/01/2017'
          }
        };

        element._searchFields[0].data[1].value = {};
        element._updateDateParameterFromField(element._searchFields[0].data[1]);

        assert.deepEqual(element.searchParameters.postingDate.dateEnd, {});
      });

      test('_updateImageGalleryFromParameter does add enabled images to the search config', function() {
        element.imageUrlPrefix = 'testPrefix/';
        element.imageUrlSuffix = '.xyz';

        element.searchParameters.image = {
          image1: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image1',
            search: 'optional',
            text: 'image1'
          },
          image2: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image2',
            search: 'required',
            text: 'image2'
          },
          image3: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image3',
            search: 'excluded',
            text: 'image3'
          },
          image4: {
            category: 'Image',
            date: undefined,
            enabled: false,
            key: 'image4',
            search: 'optional',
            text: 'image4'
          },
          image5: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image5',
            search: 'union',
            text: 'image5'
          }
        };

        element._searchFields[4].data[0] = {
          key: 'image',
          images: [{
            id: 'image1',
          }, {
            id: 'image6'
          }],
          selected: ['image6']
        };

        element._updateImageGalleryFromParameter(element._searchFields[4].data[0], ['_searchFields', 4, 'data', 0]);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          excluded: ['image3'],
          images: [{
            id: 'image1',
            search: 'optional',
            source: 'testPrefix/image1.xyz'
          }, {
            id: 'image2',
            search: 'required',
            source: 'testPrefix/image2.xyz'
          }, {
            id: 'image3',
            search: 'excluded',
            source: 'testPrefix/image3.xyz'
          }, {
            id: 'image5',
            search: 'union',
            source: 'testPrefix/image5.xyz'
          }],
          required: ['image2'],
          selected: ['image1', 'image2', 'image3', 'image5'],
          union: ['image5']
        });
      });

      test('_updateImageParameterFromGallery does add selected images to searchParameters', function() {
        element.searchParameters.image = {
          image1: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image1',
            search: 'optional',
            text: 'image1'
          },
          image2: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image2',
            search: 'optional',
            text: 'image2'
          },
          image3: {
            category: 'Image',
            date: undefined,
            enabled: false,
            key: 'image3',
            search: 'optional',
            text: 'image3'
          },
          image4: {
            category: 'Image',
            date: undefined,
            enabled: false,
            key: 'image4',
            search: 'optional',
            text: 'image4'
          },
          image5: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image5',
            search: 'union',
            text: 'image5'
          }
        };

        element._updateImageParameterFromGallery({
          icon: 'image-icon',
          key: 'image',
          styleClass: 'image-style',
          title: 'Image',
          excluded: ['image4'],
          images: [{
            id: 'image1',
            search: 'optional'
          }, {
            id: 'image2',
            search: 'optional'
          }, {
            id: 'image3',
            search: 'optional'
          }, {
            id: 'image4',
            search: 'excluded'
          }, {
            id: 'image5',
            search: 'union'
          }, {
            id: 'image6',
            search: 'required'
          }],
          required: ['image6'],
          selected: ['image1', 'image4', 'image5', 'image6'],
          union: ['image5']
        });

        assert.deepEqual(element.searchParameters.image, {
          image1: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image1',
            search: 'optional',
            text: 'image1'
          },
          image2: {
            category: 'Image',
            date: undefined,
            enabled: false,
            key: 'image2',
            search: undefined,
            text: 'image2'
          },
          image3: {
            category: 'Image',
            date: undefined,
            enabled: false,
            key: 'image3',
            search: 'optional',
            text: 'image3'
          },
          image4: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image4',
            search: 'excluded',
            text: 'image4'
          },
          image5: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image5',
            search: 'union',
            text: 'image5'
          },
          image6: {
            category: 'Image',
            date: undefined,
            enabled: true,
            key: 'image6',
            search: 'required',
            text: 'image6'
          }
        });
      });

      test('_updateSearchFieldFromParameter does update _searchFields as expected', function() {
        element.searchParameters.city = {
          nyc: {
            key: 'nyc',
            category: 'City',
            enabled: true,
            text: 'nyc',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          },
          chicago: {
            key: 'chicago',
            category: 'City',
            enabled: true,
            text: 'chicago',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          },
          la: {
            key: 'la',
            category: 'City',
            enabled: false,
            text: 'la',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          }
        };

        element._updateSearchFieldFromParameter(element._searchFields[2].data[0], ['_searchFields', 2, 'data', 0]);

        assert.deepEqual(element._searchFields[2].data[0], {
          icon: 'city-icon',
          key: 'city',
          styleClass: 'city-style',
          title: 'City',
          value: 'nyc, chicago',
          activateNetworkExpansion: false,
          activateNetworkExpansionPrevious: false,
          enableNetworkExpansion: true,
          requireOne: false,
          requireOnePrevious: true
        });
        assert.equal(element.$$('#input_city').value, 'nyc, chicago');
      });

      test('_updateSearchFieldFromParameter does update _searchFields as expected if a term is required', function() {
        element.searchParameters.city = {
          nyc: {
            key: 'nyc',
            category: 'City',
            enabled: true,
            search: 'required',
            text: 'nyc',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          },
          chicago: {
            key: 'chicago',
            category: 'City',
            enabled: true,
            text: 'chicago',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          }
        };
        element._updateSearchFieldFromParameter(element._searchFields[2].data[0], ['_searchFields', 2, 'data', 0]);

        assert.deepEqual(element._searchFields[2].data[0], {
          icon: 'city-icon',
          key: 'city',
          styleClass: 'city-style',
          title: 'City',
          value: '+nyc, chicago',
          activateNetworkExpansion: false,
          activateNetworkExpansionPrevious: false,
          enableNetworkExpansion: true,
          requireOne: false,
          requireOnePrevious: true
        });
        assert.equal(element.$$('#input_city').value, '+nyc, chicago');
      });

      test('_updateSearchFieldFromParameter does update _searchFields as expected if a term is excluded', function() {
        element.searchParameters.city = {
          nyc: {
            key: 'nyc',
            category: 'City',
            enabled: true,
            search: 'excluded',
            text: 'nyc',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          },
          chicago: {
            key: 'chicago',
            category: 'City',
            enabled: true,
            text: 'chicago',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: true,
            requireOne: false,
            requireOnePrevious: false
          }
        };
        element._updateSearchFieldFromParameter(element._searchFields[2].data[0], ['_searchFields', 2, 'data', 0]);

        assert.deepEqual(element._searchFields[2].data[0], {
          icon: 'city-icon',
          key: 'city',
          styleClass: 'city-style',
          title: 'City',
          value: '-nyc, chicago',
          activateNetworkExpansion: false,
          activateNetworkExpansionPrevious: false,
          enableNetworkExpansion: true,
          requireOne: false,
          requireOnePrevious: true
        });
        assert.equal(element.$$('#input_city').value, '-nyc, chicago');
      });

      test('_updateSearchFieldFromParameter does update _searchFields as expected if a term is lessthan or morethan', function() {
        element.searchParameters.description = {
          123: {
            key: '123',
            category: 'Description',
            enabled: true,
            search: 'morethan',
            text: '123',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: false,
            requireOnePrevious: false
          },
          456: {
            key: '456',
            category: 'Description',
            enabled: true,
            search: 'lessthan',
            text: '456',
            activateNetworkExpansion: false,
            activateNetworkExpansionPrevious: false,
            enableNetworkExpansion: false,
            requireOne: false,
            requireOnePrevious: false
          }
        };
        element._updateSearchFieldFromParameter(element._searchFields[3].data[2], ['_searchFields', 3, 'data', 2]);

        assert.deepEqual(element._searchFields[3].data[2], {
          icon: 'description-icon',
          key: 'description',
          styleClass: 'description-style',
          title: 'Description',
          value: '>123, <456',
          activateNetworkExpansion: false,
          activateNetworkExpansionPrevious: false,
          enableNetworkExpansion: false,
          requireOne: false,
          requireOnePrevious: true
        });
        assert.equal(element.$$('#input_description').value, '>123, <456');
      });

      test('_updateSearchParameterAndNotify does update searchParameters and notify listeners', function(done) {
        element.onSearchParametersChange = function() {
          assert.deepEqual(element.searchParameters.city, {
            chicago: {
              key: 'chicago',
              date: undefined,
              category: 'City',
              enabled: true,
              search: 'optional',
              text: 'chicago'
            }
          });
          done();
        };

        element.listen(element, 'search-parameters-changed', 'onSearchParametersChange');

        assert.deepEqual(element.searchParameters.city, {});

        element._updateSearchParameterAndNotify('city', 'chicago', 'City', true, 'optional');
      });

      test('_updateSearchParameterFromField does update searchParameters and networkExpansionParameters as expected', function() {
        element.$$('#input_city').value = 'nyc, chicago';

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });

        assert.deepEqual(element.networkExpansionParameters, {
          city: false
        });
      });

      test('_updateSearchParameterFromField does update searchParameters and networkExpansionParameters as expected if network expasion is on and _isNetworkExpansionViable is true', function() {
        element.$$('#input_city').value = 'nyc, chicago';

        element._searchFields[2].data[0].activateNetworkExpansion = true;

        element._isNetworkExpansionViable = true;

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });

        assert.deepEqual(element.networkExpansionParameters, {
          city: true
        });
      });

      test('_updateSearchParameterFromField does update searchParameters and networkExpansionParameters as expected if network expansion is on and _isNetworkExpansionViable is false', function() {
        element.$$('#input_city').value = 'nyc, chicago';

        element._searchFields[2].data[0].activateNetworkExpansion = true;

        element._isNetworkExpansionViable = false;

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });

        assert.deepEqual(element.networkExpansionParameters, {
          city: false
        });
      });

      test('_updateSearchParameterFromField does remove formatting from phone numbers', function() {
        element.$$('#input_phone').value = '111-222-3333';

        // phoneConfig is first in data array for identifiers
        element._updateSearchParameterFromField(element._searchFields[1].data[0]);

        assert.deepEqual(element.searchParameters.phone, {
          '1112223333': {
            key: '1112223333',
            date: undefined,
            category: 'Telephone Number',
            enabled: true,
            search: 'union',
            text: '1112223333'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if a term is a plus sign', function() {
        element.$$('#input_city').value = '+nyc, chicago';

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'required',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if a term is a minus sign', function() {
        element.$$('#input_city').value = '-nyc, chicago';

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'excluded',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if a term is a greater than or less than sign', function() {
        element.$$('#input_description').value = '>123, <456';

        element._updateSearchParameterFromField(element._searchFields[3].data[2]);

        assert.deepEqual(element.searchParameters.description, {
          123: {
            key: '123',
            date: undefined,
            category: 'Description',
            enabled: true,
            search: 'morethan',
            text: '123'
          },
          456: {
            key: '456',
            date: undefined,
            category: 'Description',
            enabled: true,
            search: 'lessthan',
            text: '456'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if requireOne is false', function() {
        element.$$('#input_city').value = 'nyc, chicago';

        element._searchFields[2].data[0].requireOne = false;

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'optional',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'optional',
            text: 'chicago'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if requireOne is false and a term is a plus sign', function() {
        element.$$('#input_city').value = '+nyc, chicago';

        element._searchFields[2].data[0].requireOne = false;

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'required',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'optional',
            text: 'chicago'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if requireOne is false and a term is a minus sign', function() {
        element.$$('#input_city').value = '-nyc, chicago';

        element._searchFields[2].data[0].requireOne = false;

        element._updateSearchParameterFromField(element._searchFields[2].data[0]);

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'excluded',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'optional',
            text: 'chicago'
          }
        });
      });

      test('_updateSearchParameterFromField does update searchParameters as expected if requireOne is false and a term is a greater than or less than sign', function() {
        element.$$('#input_description').value = '>123, <456';

        element._searchFields[3].data[2].requireOne = false;

        element._updateSearchParameterFromField(element._searchFields[3].data[2]);

        assert.deepEqual(element.searchParameters.description, {
          123: {
            key: '123',
            date: undefined,
            category: 'Description',
            enabled: true,
            search: 'morethan',
            text: '123'
          },
          456: {
            key: '456',
            date: undefined,
            category: 'Description',
            enabled: true,
            search: 'lessthan',
            text: '456'
          }
        });
      });

      test('_updateSearchParametersFromFields does update searchParameters as expected', function() {
        element.$$('#input_city').value = 'nyc, chicago';
        element._searchFields[0].data[0].value = {};
        element._searchFields[0].data[1].value = {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateEnd',
            search: 'required',
            text: '03/01/2017'
          }
        };

        element._updateSearchParametersFromFields();

        assert.deepEqual(element.searchParameters.city, {
          nyc: {
            key: 'nyc',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'nyc'
          },
          chicago: {
            key: 'chicago',
            date: undefined,
            category: 'City',
            enabled: true,
            search: 'union',
            text: 'chicago'
          }
        });

        assert.deepEqual(element.searchParameters.postingDate, {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateEnd',
            search: 'required',
            text: '03/01/2017'
          }
        });
      });

      test('cancelSearch closes dialog and does not update searchParameters', function() {
        element.$$('#input_city').value = 'nyc, chicago';
        element.opened = true;
        element.cancelSearch();

        assert.isFalse(element.opened);
        assert.equal(element.$$('#input_city').value, 'nyc, chicago');
        assert.deepEqual(element.searchParameters.city, {});
      });

      test('cancelSearch does update toggle values with previous values', function() {
        element.$$('#input_city').value = 'nyc, chicago';
        element.opened = true;

        element.cancelSearch();

        assert.isFalse(element.opened);
        assert.isFalse(element._searchFields[2].data[0].activateNetworkExpansion);
        assert.isTrue(element._searchFields[2].data[0].requireOne);
      });

      test('handleSearch does nothing if no fields are specified', function() {
        element.opened = true;
        element.removeAllSearchTerms();
        element.handleSearch();

        assert.isTrue(element.opened);
      });

      test('handleSearch does update previous toggle values', function() {
        element.$$('#input_city').value = 'nyc, chicago';
        element.opened = true;
        element._searchFields[2].data[0].activateNetworkExpansion = true;
        element._searchFields[2].data[0].requireOne = false;

        element.handleSearch();

        assert.isFalse(element.opened);
        assert.isTrue(element._searchFields[2].data[0].activateNetworkExpansionPrevious);
        assert.isFalse(element._searchFields[2].data[0].requireOnePrevious);
      });

      test('handleSearch updates searchParameters and closes dialog', function() {
        element.opened = true;

        element.$$('#input_city').value = 'nyc, chicago';
        element.$$('#input_phone').value = '1112223333';

        element.handleSearch();

        assert.isFalse(element.opened);
        assert.deepEqual(element.searchParameters, {
          city: {
            nyc: {
              key: 'nyc',
              date: undefined,
              category: 'City',
              enabled: true,
              search: 'union',
              text: 'nyc'
            },
            chicago: {
              key: 'chicago',
              date: undefined,
              category: 'City',
              enabled: true,
              search: 'union',
              text: 'chicago'
            }
          },
          country: {},
          description: {},
          email: {},
          image: {},
          phone: {
            '1112223333': {
              key: '1112223333',
              date: undefined,
              category: 'Telephone Number',
              enabled: true,
              search: 'union',
              text: '1112223333'
            }
          },
          postingDate: {},
          title: {},
          url: {},
          website: {}
        });
      });

      test('openHelp does open the help dialog', function() {
        element.openHelp();
        assert.isTrue(element._openedDialogHelp);
        assert.isTrue(element.$$('.help-dialog').opened);
        assert.isTrue(element.$$('.search-dialog').classList.contains('backdrop'));
      });

      test('openImages does open the images dialog', function() {
        element.openImages();
        assert.isTrue(element._openedDialogImages);
        assert.isTrue(element.$$('.images-dialog').opened);
        assert.isTrue(element.$$('.search-dialog').classList.contains('backdrop'));
      });

      test('removeAllSearchTerms does have expected behavior', function() {
        element.$$('#input_city').value = 'nyc, chicago';
        element._searchFields[0].data[0].value = {};
        element._searchFields[0].data[1].value = {
          dateEnd: {
            category: 'To',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateEnd',
            search: 'required',
            text: '03/01/2017'
          }
        };
        element._searchFields[4].data[0].images = [{
          id: 'image1'
        }];
        element._searchFields[4].data[0].selected = ['image1'];

        element.removeAllSearchTerms();

        assert.deepEqual(element._searchFields[0].data[0].value, {});
        assert.deepEqual(element._searchFields[0].data[1].value, {});
        assert.deepEqual(element._searchFields[2].data[0].value, '');
        assert.deepEqual(element._searchFields[4].data[0].images, [{
          id: 'image1'
        }]);
        assert.deepEqual(element._searchFields[4].data[0].selected, []);
      });

      test('toggleSearchFieldsDialog does have expected behavior when toggling dialog open', function() {
        element.searchParameters.city = {
          nyc: {
            key: 'nyc',
            category: 'City',
            enabled: true,
            search: 'optional',
            text: 'nyc'
          },
        };
        element.searchParameters.postingDate = {
          dateStart: {
            category: 'From',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateStart',
            search: 'required',
            text: '03/01/2017'
          }
        };

        element.toggleSearchFieldsDialog();

        // dialog is opened and fields are updated based on searchParameters
        assert.isTrue(element.opened);
        assert.equal(element.$$('#input_city').value, 'nyc');
        assert.deepEqual(element._searchFields[0].data[0].value, {
          dateStart: {
            category: 'From',
            date: '2017-03-01T00:00:00',
            enabled: false,
            key: 'dateStart',
            search: 'required',
            text: '03/01/2017'
          }
        });
      });

      test('toggleSearchFieldsDialog does have expected behavior when toggling dialog closed', function() {
        element.opened = true;
        element.searchParameters.city = {
          la: {
            key: 'la',
            category: 'City',
            enabled: false,
            search: 'optional',
            text: 'la'
          }
        };
        element.toggleSearchFieldsDialog();

        // dialog is closed and fields are not updated based on searchParameters (that should
        // only happen when dialog is being opened).
        assert.isFalse(element.opened);
        assert.notEqual(element.$$('#input_city').value, 'la');
      });

      test('toggleShowAdvanced does have expected behavior', function() {
        element.toggleShowAdvanced();
        assert.isTrue(element._showAdvanced);

        element.toggleShowAdvanced();
        assert.isFalse(element._showAdvanced);
      });

      test('setting _imagesSelected does update _imageResults', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }, {
          id: 'image2',
          hits: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }]
        }];

        element._imagesSelected = ['image2'];

        assert.deepEqual(element._imageResults, {
          id: 'image2',
          images: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }],
          selected: []
        });
      });

      test('setting _imagesSelected with multiple images does update _imageResults', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }, {
          id: 'image2',
          hits: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }]
        }];

        element._imagesSelected = ['image1', 'image2'];

        assert.deepEqual(element._imageResults, {
          id: 'image2',
          images: [{
            id: 'hit3',
            source: 'source3'
          }, {
            id: 'hit4',
            source: 'source4'
          }],
          selected: []
        });
      });

      test('setting _imageResults.images does update images', function() {
        element.images = [{
          id: 'image1',
          hits: [{
            id: 'hit1',
            source: 'source1'
          }, {
            id: 'hit2',
            source: 'source2'
          }]
        }];

        element._imageResults.images = [{
          id: 'hit2',
          source: 'source2'
        }];

        assert.deepEqual(element._imageResults, {
          images: [{
            id: 'hit2',
            source: 'source2'
          }],
          selected: []
        });
      });

      test('setting _imageResults.selected does update _searchFields', function() {
        element._searchFields[4].data[0] = {
          key: 'image',
          images: [],
          selected: [],
          union: []
        };

        element._imageResults.images = [{
          id: 'image1',
          source: 'source1'
        }];

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [],
          selected: [],
          union: []
        });

        element.set('_imageResults.selected', ['image1']);

        assert.deepEqual(element._searchFields[4].data[0], {
          key: 'image',
          images: [{
            id: 'image1',
            source: 'source1'
          }],
          selected: ['image1'],
          union: ['image1']
        });
      });

      test('does have _updateFocusedInput function', function() {
        assert.isFunction(element._updateFocusedInput);
      });

      test('does call _updateFocusedInput on opened property change', function() {
        var called = 0;
        element._updateFocusedInput = function() {
          ++called;
        };

        element.opened = true;
        assert.equal(called, 1);

        element.opened = false;
        assert.equal(called, 2);

        element._openedDialogHelp = true;
        assert.equal(called, 3);

        element._openedDialogHelp = false;
        assert.equal(called, 4);

        element._openedDialogImages = true;
        assert.equal(called, 5);

        element._openedDialogImages = false;
        assert.equal(called, 6);
      });
    });
  </script>
</body>
</html>
